# Ralph Progress Log
## Codebase Patterns
<!-- Reusable patterns discovered across iterations — update this section, don't append -->

- **WorkflowStep model**: `Models/WorkflowStep.cs` — simple record-like class with `StepIndex`, `Title`, `Category`, `Icon` (all `init`-only)
- **ViewModel pattern**: `HedgingDiagramViewModel` exposes both `IReadOnlyList<string> Nodes` (legacy) and `IReadOnlyList<WorkflowStep> WorkflowSteps` (new)
- **Categories**: data-input, processing, approval, output — map to Material Design color palette

---
<!-- Iteration logs below — always append, never replace -->

## 2026-02-22 - US-001: Commit WorkflowStep model and ViewModel changes
- Staged and committed WorkflowStep.cs, HedgingDiagramViewModel.cs, IHedgingDiagramViewModel.cs
- Files changed: Models/WorkflowStep.cs (new), ViewModels/HedgingDiagramViewModel.cs, ViewModels/IHedgingDiagramViewModel.cs
- **Learnings for future iterations:**
  - WorkflowStep uses `init`-only properties — immutable after construction
  - The ViewModel maintains both legacy `Nodes` (string list) and new `WorkflowSteps` for backward compatibility
  - 9 workflow steps (0-8) with 4 categories: data-input (2), processing (3), approval (1), output (3)

## 2026-02-22 - US-002: Commit and verify WorkflowStep unit tests
- Staged and committed HedgingDiagramViewModelTests.cs with 5 WorkflowStep tests
- Files changed: tests/Pemberton.Shareclass.Hedging.Prototype.Tests/HedgingDiagramViewModelTests.cs
- **Learnings for future iterations:**
  - Test file already had `Nodes_ShouldContainApprovalsAndReporting` from before — 4 new WorkflowStep tests added alongside
  - Tests instantiate `HedgingDiagramViewModel` directly (no mocking needed — no service dependencies)
  - Total unit test count is now 8 (3 wizard + 5 diagram)

## 2026-02-22 - US-003: Commit diagram page rewrite with CSS Grid and Material Design
- Atomic commit of the core UI rewrite: CSS Grid layout, Material Icons, HedgeNode component
- Files changed: Pages/HedgingDiagram.razor, Components/HedgeNode.razor, wwwroot/css/hedging.css, Pages/_Host.cshtml, csproj, _Imports.razor, DiagramPageTests.cs
- **Learnings for future iterations:**
  - Removed Z.Blazor.Diagrams dependency in favor of pure CSS Grid + custom HedgeNode component
  - HedgeNode.razor uses `@Category` as a CSS class on `.hedge-node` div for color mapping
  - E2E tests use `getComputedStyle` via Playwright's `EvaluateAsync<string>()` for style assertions
  - CSS arrows use `::after` pseudo-elements with Unicode arrow characters
  - Category colors: data-input=#1976D2, processing=#00897B, approval=#F57C00, output=#388E3C

## 2026-02-22 - US-004: Commit sidebar Material Design styling and navigation tests
- Sidebar themed with dark background, active link highlight, E2E navigation tests
- Files changed: wwwroot/css/app.css, Shared/NavMenu.razor, NavigationTests.cs
- **Learnings for future iterations:**
  - Sidebar colors: background #20232a, active highlight #61dafb (rgb(97, 218, 251))
  - Active links have `border-left: 3px solid #61dafb` indicator
  - NavMenu uses Blazor `NavLink` component with `NavLinkMatch.All` for home route
  - E2E tests for CSS use pattern: `EvaluateAsync<string>("el => window.getComputedStyle(el).propertyName")`

## 2026-02-22 - US-005: Commit wizard back-navigation E2E tests
- Committed WizardBackNavigationTests.cs with 4 back-navigation tests
- Files changed: tests/.../WizardBackNavigationTests.cs (new)
- **Learnings for future iterations:**
  - E2E test helpers `ClickNextAndWaitFor`/`ClickBackAndWaitFor` accept a locator to wait for after click
  - Back button uses `Page.Locator("button").Filter(new LocatorFilterOptions { HasText = "Back" })`
  - Wizard step headers are `h4` elements, identifiable by step title text

## 2026-02-22 - US-006: Commit wizard post-approval E2E tests
- Committed WizardPostApprovalTests.cs with 5 tests covering steps 6-8
- Files changed: tests/.../WizardPostApprovalTests.cs (new)
- **Learnings for future iterations:**
  - Approval gate pattern: find approver name cell, traverse to parent `<tr>` via XPath, find Approve button
  - After clicking Approve, wait for button to become disabled (confirms state change)
  - Step 6 renders execution result in `div.mt-4 p`; step 7 shows "Reporting" heading; step 8 shows "Movements booked"
  - Next button is disabled on the final step (step 8)

## 2026-02-22 - US-007: Add E2E test for Material Icons font loading
- Added DiagramPage_MaterialIcons_FontIsLoaded test to DiagramPageTests.cs
- Files changed: tests/.../DiagramPageTests.cs
- **Learnings for future iterations:**
  - Use `EvaluateAsync<string>("el => window.getComputedStyle(el).fontFamily")` to check font-family
  - Use `EvaluateAsync<int>("el => el.offsetWidth")` to verify element has non-zero rendered dimensions
  - Material Icons font-family string contains "Material Icons" when loaded from Google Fonts CDN

## 2026-02-22 - US-008: Add E2E test for category background colors
- Added DiagramPage_Nodes_HaveCategoryBackgroundColors test to DiagramPageTests.cs
- Files changed: tests/.../DiagramPageTests.cs
- **Learnings for future iterations:**
  - Use `EvaluateAsync<string>("el => window.getComputedStyle(el).backgroundColor")` for background color assertions
  - Browser returns colors in `rgb(r, g, b)` format — assert against that, not hex
  - Test one representative node per category: node 0 (data-input), node 2 (processing), node 5 (approval), node 6 (output)
  - Category-to-color mapping: data-input=rgb(25, 118, 210), processing=rgb(0, 137, 123), approval=rgb(245, 124, 0), output=rgb(56, 142, 60)
