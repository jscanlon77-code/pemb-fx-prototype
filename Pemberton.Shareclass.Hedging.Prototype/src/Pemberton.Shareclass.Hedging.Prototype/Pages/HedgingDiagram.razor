@page ""/diagram""
@using Blazor.Diagrams
@using Blazor.Diagrams.Core.Models
@using Blazor.Diagrams.Core.Geometry
@inject IHedgingDiagramViewModel Vm

<h3>Hedging Workflow Diagram</h3>

<BlazorDiagram Model=""@diagram"" />

@code {
    private Diagram diagram = default!;

    protected override void OnInitialized()
    {
        diagram = new Diagram();

        var nodes = new List<NodeModel>();

        double x = 50;
        double y = 50;

        foreach (var title in Vm.Nodes)
        {
            var node = new NodeModel(new Point(x, y))
            {
                Title = title
            };
            node.AddPort(PortAlignment.Right);
            node.AddPort(PortAlignment.Left);
            nodes.Add(node);
            x += 250;
        }

        foreach (var node in nodes)
        {
            diagram.Nodes.Add(node);
        }

        for (int i = 0; i < nodes.Count - 1; i++)
        {
            var link = new LinkModel(
                nodes[i].GetDefaultPort(PortAlignment.Right),
                nodes[i + 1].GetDefaultPort(PortAlignment.Left));
            diagram.Links.Add(link);
        }
    }
}
